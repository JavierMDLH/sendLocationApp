<!DOCTYPE html>
<html>
<head>
    <title>Últimos datos recibidos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
</head>
<body>
    <h1>Últimos datos recibidos:</h1>
    <p>Latitud: <span id="latitud"></span></p>
    <p>Longitud: <span id="longitud"></span></p>
    <p>Altitud: <span id="altitud"></span></p>
    <p>Timestamp: <span id="timestamp"></span></p>

    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
    
        socket.on('connect', function() {
            console.log('Conectado al servidor WebSocket');
        });
    
        socket.on('disconnect', function() {
            console.log('Desconectado del servidor WebSocket');
        });

        // Función para formatear la fecha
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            
            // Ajustar la zona horaria a tu zona deseada (por ejemplo, GMT-5 para restar 5 horas)
            const adjustedDate = new Date(date.getTime() - (5 * 60 * 60 * 1000));
            
            const year = adjustedDate.getFullYear();
            const month = String(adjustedDate.getMonth() + 1).padStart(2, '0');
            const day = String(adjustedDate.getDate()).padStart(2, '0');
            let hour = String(adjustedDate.getHours()).padStart(2, '0');
            const minute = String(adjustedDate.getMinutes()).padStart(2, '0');
            const second = String(adjustedDate.getSeconds()).padStart(2, '0');

            // Convertir la hora a formato de 12 horas si es necesario
            let ampm = 'AM';
            if (hour >= 12) {
                hour = String(hour - 12).padStart(2, '0');
                ampm = 'PM';
            }

            return `${year}-${month}-${day} ${hour}:${minute}:${second} ${ampm}`;
        }
    
        socket.on('update_data', function(data) {
            console.log('Datos actualizados recibidos:', data);
            updateDataOnPage(data);
        });
    
        function updateDataOnPage(data) {
            console.log('Actualizando datos en la página:', data);
            document.getElementById('latitud').innerText = data[0];
            document.getElementById('longitud').innerText = data[1];
            document.getElementById('altitud').innerText = data[2];
            console.log('Timestamp antes de formatear:', data[3]);
            document.getElementById('timestamp').innerText = formatDate(data[3]);
        }
    </script>
</body>
</html>